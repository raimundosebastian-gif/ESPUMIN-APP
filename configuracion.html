<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESPUMIN - Configuración</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Menú -->
    <div id="menu-container"></div>

    <main class="modulo-container">
        <h1>Configuración del Sistema</h1>

        <!-- Formulario -->
        <section class="form-section">
            <input type="hidden" id="id">

            <label>Nombre de la empresa</label>
            <input type="text" id="empresa" placeholder="Ej: ESPUMIN">

            <label>Dirección</label>
            <input type="text" id="direccion" placeholder="Ej: Calle 123">

            <label>Teléfono</label>
            <input type="text" id="telefono" placeholder="Ej: 2477-555555">

            <label>Correo</label>
            <input type="email" id="correo" placeholder="Ej: empresa@mail.com">

            <button id="guardarBtn">Guardar</button>
        </section>
    </main>

    <script src="js/core.js"></script>
    <script>
        protegerModulo();

        // Cargar menú
        fetch("menu.html")
            .then(r => r.text())
            .then(html => document.getElementById("menu-container").innerHTML = html);

        // Cargar datos
        function cargarDatos() {
            const cfg = getData("configuracion")[0];

            if (cfg) {
                document.getElementById("id").value = cfg.id;
                document.getElementById("empresa").value = cfg.empresa;
                document.getElementById("direccion").value = cfg.direccion;
                document.getElementById("telefono").value = cfg.telefono;
                document.getElementById("correo").value = cfg.correo;
            }
        }

        // Guardar
        document.getElementById("guardarBtn").addEventListener("click", () => {
            const id = document.getElementById("id").value;
            const empresa = document.getElementById("empresa").value.trim();
            const direccion = document.getElementById("direccion").value.trim();
            const telefono = document.getElementById("telefono").value.trim();
            const correo = document.getElementById("correo").value.trim();

            if (!empresa) {
                alert("El nombre de la empresa es obligatorio");
                return;
            }

            let cfg = getData("configuracion");

            if (id) {
                // Editar
                const item = cfg.find(c => c.id === id);
                item.empresa = empresa;
                item.direccion = direccion;
                item.telefono = telefono;
                item.correo = correo;

                registrarAuditoria("Configuración", "Edición", "Actualizó datos de la empresa");
            } else {
                // Nuevo
                cfg = [{
                    id: generarID(),
                    empresa,
                    direccion,
                    telefono,
                    correo
                }];

                registrarAuditoria("Configuración", "Alta", "Registró datos de la empresa");
            }

            setData("configuracion", cfg);
            alert("Configuración guardada correctamente");
        });

        // Inicializar
        cargarDatos();
    </script>

</body>
</html>
