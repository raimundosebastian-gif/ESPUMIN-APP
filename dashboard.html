<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESPUMIN - Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Menú principal -->
    <div id="menu-container"></div>

    <!-- Contenido principal del dashboard -->
    <main class="dashboard-container">
        <h1>Dashboard ESPUMIN</h1>

        <section class="dashboard-grid">
            <div class="card">
                <h2>Clientes</h2>
                <p id="dash-clientes">-</p>
            </div>

            <div class="card">
                <h2>Productos</h2>
                <p id="dash-productos">-</p>
            </div>

            <div class="card">
                <h2>Ventas</h2>
                <p id="dash-ventas">-</p>
            </div>

            <div class="card">
                <h2>Stock total</h2>
                <p id="dash-stock">-</p>
            </div>

            <div class="card">
                <h2>Notificaciones</h2>
                <p id="dash-notificaciones">-</p>
            </div>

            <div class="card">
                <h2>Última auditoría</h2>
                <p id="dash-auditoria">-</p>
            </div>
        </section>
    </main>

    <!-- Core del sistema + seguridad + menú + indicadores -->
    <script src="js/core.js"></script>
    <script>
        // Proteger acceso
        protegerModulo();

        // Cargar menú
        fetch("menu.html")
            .then(r => r.text())
            .then(html => {
                const cont = document.getElementById("menu-container");
                if (cont) cont.innerHTML = html;
            });

        // Cargar indicadores básicos
        document.addEventListener("DOMContentLoaded", () => {
            const clientes = getData("clientes");
            const productos = getData("productos");
            const ventas = getData("ventas");
            const inventario = getData("inventario");
            const notificaciones = getData("notificaciones");
            const auditoria = getData("auditoria");

            const totalStock = inventario.reduce((acc, item) => acc + (Number(item.stock) || 0), 0);
            const ultimaAud = auditoria.length > 0 ? auditoria[auditoria.length - 1] : null;

            const setText = (id, value) => {
                const el = document.getElementById(id);
                if (el) el.textContent = value;
            };

            setText("dash-clientes", clientes.length);
            setText("dash-productos", productos.length);
            setText("dash-ventas", ventas.length);
            setText("dash-stock", totalStock);
            setText("dash-notificaciones", notificaciones.filter(n => !n.revisada).length);
            setText(
                "dash-auditoria",
                ultimaAud
                    ? `${formatDate(ultimaAud.fecha)} - ${ultimaAud.modulo} - ${ultimaAud.tipo}`
                    : "Sin registros"
            );
        });
    </script>

</body>
</html>
