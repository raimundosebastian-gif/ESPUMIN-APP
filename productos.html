/* ============================================================
   PRODUCTOS (ADAPTADO A TU HTML)
============================================================ */
function guardarProducto() {
    const nombre = document.getElementById("prod-nombre").value.trim();
    const precio = parseFloat(document.getElementById("prod-precio").value.trim());
    const categoria = document.getElementById("prod-categoria").value.trim();
    const estado = document.getElementById("prod-estado").value.trim();

    if (!nombre || isNaN(precio) || !categoria || !estado) {
        alert("Completa todos los campos.");
        return;
    }

    const productos = JSON.parse(localStorage.getItem("productos")) || [];

    productos.push({
        nombre: capitalizar(nombre),
        precio,
        categoria,
        estado
    });

    localStorage.setItem("productos", JSON.stringify(productos));

    document.getElementById("prod-nombre").value = "";
    document.getElementById("prod-precio").value = "";
    document.getElementById("prod-categoria").value = "";
    document.getElementById("prod-estado").value = "Activo";

    mostrarProductos();
}

function mostrarProductos() {
    const cont = document.getElementById("lista-productos");
    if (!cont) return;

    const productos = JSON.parse(localStorage.getItem("productos")) || [];

    if (productos.length === 0) {
        cont.innerHTML = "<p>No hay productos cargados.</p>";
        return;
    }

    let html = `
        <table>
            <tr>
                <th>Nombre</th>
                <th>Precio</th>
                <th>Categoría</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
    `;

    productos.forEach((p, i) => {
        html += `
            <tr>
                <td>${p.nombre}</td>
                <td>$${p.precio.toFixed(2)}</td>
                <td>${p.categoria}</td>
                <td>${p.estado}</td>
                <td>
                    <button class="btn-accion btn-editar" onclick="editarProducto(${i})">Editar</button>
                    <button class="btn-accion btn-eliminar" onclick="eliminarProducto(${i})">Eliminar</button>
                </td>
            </tr>
        `;
    });

    html += "</table>";
    cont.innerHTML = html;
}

function buscarProductos() {
    const texto = document.getElementById("buscar-producto").value.toLowerCase();
    const cont = document.getElementById("lista-productos");
    const productos = JSON.parse(localStorage.getItem("productos")) || [];

    const filtrados = productos.filter(p =>
        p.nombre.toLowerCase().includes(texto) ||
        p.categoria.toLowerCase().includes(texto) ||
        p.estado.toLowerCase().includes(texto)
    );

    if (filtrados.length === 0) {
        cont.innerHTML = "<p>No se encontraron coincidencias.</p>";
        return;
    }

    let html = `
        <table>
            <tr>
                <th>Nombre</th>
                <th>Precio</th>
                <th>Categoría</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
    `;

    filtrados.forEach((p, i) => {
        html += `
            <tr>
                <td>${p.nombre}</td>
                <td>$${p.precio.toFixed(2)}</td>
                <td>${p.categoria}</td>
                <td>${p.estado}</td>
                <td>
                    <button class="btn-accion btn-editar" onclick="editarProducto(${i})">Editar</button>
                    <button class="btn-accion btn-eliminar" onclick="eliminarProducto(${i})">Eliminar</button>
                </td>
            </tr>
        `;
    });

    html += "</table>";
    cont.innerHTML = html;
}

function eliminarProducto(i) {
    const productos = JSON.parse(localStorage.getItem("productos")) || [];
    if (!confirm("¿Eliminar este producto?")) return;

    productos.splice(i, 1);
    localStorage.setItem("productos", JSON.stringify(productos));

    mostrarProductos();
}

function editarProducto(i) {
    const productos = JSON.parse(localStorage.getItem("productos")) || [];
    const p = productos[i];

    const nombre = prompt("Nuevo nombre:", p.nombre);
    const precio = parseFloat(prompt("Nuevo precio:", p.precio));
    const categoria = prompt("Nueva categoría:", p.categoria);
    const estado = prompt("Nuevo estado (Activo/Inactivo):", p.estado);

    if (!nombre || isNaN(precio) || !categoria || !estado) {
        alert("Datos inválidos.");
        return;
    }

    productos[i] = {
        nombre: capitalizar(nombre),
        precio,
        categoria,
        estado
    };

    localStorage.setItem("productos", JSON.stringify(productos));
    mostrarProductos();
}
