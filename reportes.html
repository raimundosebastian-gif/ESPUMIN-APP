<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESPUMIN - Reportes</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Menú -->
    <div id="menu-container"></div>

    <main class="modulo-container">
        <h1>Reportes del Sistema</h1>

        <!-- Selector -->
        <section class="form-section">
            <label>Seleccionar reporte</label>
            <select id="tipoReporte">
                <option value="ventas">Ventas</option>
                <option value="compras">Compras</option>
                <option value="produccion">Producción</option>
                <option value="caja">Caja</option>
                <option value="inventario">Inventario</option>
                <option value="cuentasClientes">Cuentas Clientes</option>
                <option value="cuentasProveedores">Cuentas Proveedores</option>
            </select>

            <button id="generarBtn">Generar</button>
        </section>

        <!-- Tabla -->
        <section class="tabla-section">
            <table>
                <thead id="thead"></thead>
                <tbody id="tbody"></tbody>
            </table>
        </section>
    </main>

    <script src="js/core.js"></script>
    <script>
        protegerModulo();

        // Cargar menú
        fetch("menu.html")
            .then(r => r.text())
            .then(html => document.getElementById("menu-container").innerHTML = html);

        // Configuración de columnas por reporte
        const columnas = {
            ventas: ["Fecha", "Cliente", "Producto", "Cantidad", "Total"],
            compras: ["Fecha", "Proveedor", "Producto", "Cantidad", "Total"],
            produccion: ["Producto", "Cantidad", "Fecha", "Estado"],
            caja: ["Fecha", "Tipo", "Monto", "Detalle"],
            inventario: ["Producto", "Stock"],
            cuentasClientes: ["Fecha", "Cliente", "Monto", "Detalle"],
            cuentasProveedores: ["Fecha", "Proveedor", "Monto", "Detalle"]
        };

        // Generar reporte
        document.getElementById("generarBtn").addEventListener("click", () => {
            const tipo = document.getElementById("tipoReporte").value;
            const data = getData(tipo);

            cargarEncabezado(tipo);
            cargarCuerpo(tipo, data);

            registrarAuditoria("Reportes", "Consulta", `Generó reporte: ${tipo}`);
        });

        // Encabezado dinámico
        function cargarEncabezado(tipo) {
            const thead = document.getElementById("thead");
            thead.innerHTML = "";

            const tr = document.createElement("tr");
            columnas[tipo].forEach(col => {
                const th = document.createElement("th");
                th.textContent = col;
                tr.appendChild(th);
            });

            thead.appendChild(tr);
        }

        // Cuerpo dinámico
        function cargarCuerpo(tipo, data) {
            const tbody = document.getElementById("tbody");
            tbody.innerHTML = "";

            data.forEach(item => {
                const tr = document.createElement("tr");

                switch (tipo) {
                    case "ventas":
                        tr.innerHTML = `
                            <td>${formatDate(item.fecha)}</td>
                            <td>${item.cliente}</td>
                            <td>${item.producto}</td>
                            <td>${item.cantidad}</td>
                            <td>$ ${item.total}</td>
                        `;
                        break;

                    case "compras":
                        tr.innerHTML = `
                            <td>${formatDate(item.fecha)}</td>
                            <td>${item.proveedor}</td>
                            <td>${item.producto}</td>
                            <td>${item.cantidad}</td>
                            <td>$ ${item.total}</td>
                        `;
                        break;

                    case "produccion":
                        tr.innerHTML = `
                            <td>${item.producto}</td>
                            <td>${item.cantidad}</td>
                            <td>${formatDate(item.fecha)}</td>
                            <td>${item.estado}</td>
                        `;
                        break;

                    case "caja":
                        tr.innerHTML = `
                            <td>${formatDate(item.fecha)}</td>
                            <td>${item.tipo}</td>
                            <td>$ ${item.monto}</td>
                            <td>${item.detalle}</td>
                        `;
                        break;

                    case "inventario":
                        tr.innerHTML = `
                            <td>${item.producto}</td>
                            <td>${item.stock}</td>
                        `;
                        break;

                    case "cuentasClientes":
                        tr.innerHTML = `
                            <td>${formatDate(item.fecha)}</td>
                            <td>${item.cliente}</td>
                            <td>$ ${item.monto}</td>
                            <td>${item.detalle}</td>
                        `;
                        break;

                    case "cuentasProveedores":
                        tr.innerHTML = `
                            <td>${formatDate(item.fecha)}</td>
                            <td>${item.proveedor}</td>
                            <td>$ ${item.monto}</td>
                            <td>${item.detalle}</td>
                        `;
                        break;
                }

                tbody.appendChild(tr);
            });
        }
    </script>

</body>
</html>
